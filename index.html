<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>事業主研修版_労働災害発生時の対応</title>
  
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CS9WF785LR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CS9WF785LR');
</script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #f7f7f7;
      color: #333;
    }
    .hidden {
      display: none;
    }
    .section {
      max-width: 800px;
      margin: auto;
      text-align: center;
    }
    .title {
      background-color: #0078d4;
      color: white;
      padding: 1em;
      border-radius: 8px;
      margin-bottom: 1em;
    }
    input[type="text"] {
      font-size: 1.2em;
      padding: 0.5em;
      width: 80%;
      max-width: 400px;
    }
    button {
      font-size: 1.2em;
      padding: 0.6em 1.2em;
      margin: 1em;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background-color: #0078d4;
      color: white;
    }
    button:hover {
      background-color: #106ebe;
    }
    .video-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      background-color: black;
      border-radius: 8px;
      overflow: hidden;
    }
    video {
      width: 100%;
      height: auto;
      display: block;
      outline: none;
    }
    /* シークバーとコントロールを非表示にする */
    video::-webkit-media-controls {
      display: none !important;
    }
    video::-moz-media-controls {
      display: none !important;
    }
    video::-webkit-media-controls-panel {
      display: none !important;
    }
    video::-webkit-media-controls-play-button {
      display: none !important;
    }
    video::-webkit-media-controls-timeline {
      display: none !important;
    }
    video::-webkit-media-controls-current-time-display {
      display: none !important;
    }
    video::-webkit-media-controls-time-remaining-display {
      display: none !important;
    }
    video::-webkit-media-controls-mute-button {
      display: none !important;
    }
    video::-webkit-media-controls-toggle-closed-captions-button {
      display: none !important;
    }
    video::-webkit-media-controls-volume-slider {
      display: none !important;
    }
    video::-webkit-media-controls-fullscreen-button {
      display: none !important;
    }
    #confirmationCode {
      font-weight: bold;
      font-size: 1.4em;
      margin-top: 1em;
      background-color: #e9e9e9;
      padding: 0.5em;
      border-radius: 6px;
      display: inline-block;
    }

    /* クイズ関連のスタイル */
    .quiz-question {
      font-size: 1.3em;
      margin-bottom: 1em;
      font-weight: bold;
    }
    .quiz-options button {
      display: block;
      width: 80%;
      margin: 0.8em auto;
      padding: 0.8em;
      background-color: #e0e0e0;
      color: #333;
      border: 1px solid #ccc;
      font-size: 1.1em;
    }
    .quiz-options button:hover {
      background-color: #d0d0d0;
    }
    .quiz-message {
      font-size: 1.1em;
      margin-top: 1em;
      font-weight: bold;
    }
    .quiz-message.correct {
      color: green;
    }
    .quiz-message.incorrect {
      color: red;
    }
    #nextQuestionButton {
      margin-top: 1em;
      background-color: #0078d4;
      color: white;
    }

    /* プライバシーポリシー関連のスタイル */
    .privacy-policy-container {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1.5em;
      margin: 1em 0;
      text-align: left;
      max-height: 400px;
      overflow-y: auto;
      font-size: 0.9em;
      line-height: 1.6;
    }
    .privacy-policy-container h3 {
      color: #0078d4;
      margin-top: 1.5em;
      margin-bottom: 0.5em;
    }
    .privacy-policy-container h3:first-child {
      margin-top: 0;
    }
    .privacy-policy-container ul {
      margin: 0.5em 0;
      padding-left: 2em;
    }
    .privacy-policy-container li {
      margin: 0.3em 0;
    }

    /* レスポンシブ対応 */
    @media (max-width: 768px) {
      input[type="text"], button {
        width: 90%;
        max-width: none;
      }
      .section {
        max-width: 95%;
      }
      .video-container {
        max-width: 100%;
      }
      .privacy-policy-container {
        font-size: 0.8em;
        padding: 1em;
      }
    }
    @media (max-width: 480px) {
      body {
        margin: 10px;
      }
      .title h2 {
        font-size: 1.2em;
      }
      button {
        font-size: 1em;
        padding: 0.5em 1em;
      }
      .quiz-options button {
        font-size: 1em;
        padding: 0.6em;
      }
      .privacy-policy-container {
        max-height: 300px;
        font-size: 0.75em;
      }
    }

    /* エラーメッセージ用のスタイル */
    .error-message {
      color: red;
      font-weight: bold;
      margin-top: 1em;
    }
  </style>
</head>
<body>

<div class="section">
  <div class="title">
    <h2>事業主研修版_労働災害発生時の対応</h2>
  </div>
</div>

<!-- プライバシーポリシー画面 -->
<div class="section" id="privacySection">
  <h3>プライバシーポリシーをご確認ください</h3>
  <div class="privacy-policy-container">
    <h3>協力業者の受講記録に関するプライバシーポリシー（受講記録について）</h3>
    
    <p>大崎建設株式会社（以下、「当社」といいます）は、[事業主研修版_労働災害発生時の対応]（以下、「本アプリ」といいます）を通じて取得する協力業者の受講記録情報について、以下のとおりプライバシーポリシーを定めます。</p>
    
    <h3>1. 取得する情報および利用目的</h3>
    <p>本アプリでは、以下の情報を取得し、労働基準監督署からの指示に基づく協力業者のルール受講状況の確認のみを目的として利用します。これらの情報をその他の用途に利用することはありません。</p>
    <ul>
      <li><strong>取得情報：</strong>受講者名、会社名、受講完了日時、利用デバイス情報（OS、ブラウザの種類）</li>
      <li><strong>利用目的：</strong>
        <ul>
          <li>労働基準監督署の指導に基づく、協力業者への労働災害発生時の対応ルール受講状況の確認</li>
          <li>受講履歴の管理、受講完了の確認のため</li>
        </ul>
      </li>
    </ul>
    
    <h3>2. 個人情報の取得方法</h3>
    <p>本アプリは、受講者がe-Learningの受講完了ボタンをクリックし、必要情報を入力・送信することで、上記の情報を取得します。</p>
    
    <h3>3. 個人情報の安全管理</h3>
    <p>当社は、取得した受講記録情報が漏洩、滅失、毀損等を防止するため、適切な安全管理措置を講じます。本アプリで取得された情報はGoogleスプレッドシートにて厳重に管理し、アクセス権限は必要最小限の担当者に限定します。</p>
    
    <h3>4. 個人情報の第三者提供</h3>
    <p>当社は、法令に基づく場合（労働基準監督署への報告等）を除き、あらかじめ受講者の同意を得ることなく、取得した受講記録情報を第三者に提供することはありません。</p>
    
    <h3>5. お問い合わせ窓口</h3>
    <p>本プライバシーポリシーに関するお問い合わせは、以下の窓口までご連絡ください。<br>
    大崎建設株式会社 安全部 担当：竹澤<br>
    電話03-5658-5012</p>
    
    <h3>6. 本プライバシーポリシーの変更</h3>
    <p>当社は、必要に応じて本プライバシーポリシーの内容を改定することがあります。変更後のプライバシーポリシーは、本ウェブサイトに掲載したときから効力を生じるものとします。</p>
    
    <p><strong>[制定日または最終改定日: 2025年6月17日]</strong></p>
  </div>
  <p>上記のプライバシーポリシーに同意いただける場合は、「同意して次へ進む」ボタンをクリックしてください。</p>
  <button onclick="agreeToPrivacyPolicy()">同意して次へ進む</button>
</div>

<!-- 名前・会社名入力画面 -->
<div class="section hidden" id="nameSection">
  <p>あなたの会社名を入力してください</p>
  <input type="text" id="companyName" placeholder="例: 安全建設" />
  <p>あなたの名前を入力してください</p>  
  <input type="text" id="userName" placeholder="例: 安全太郎" />
  <p>当社担当者が判別出来れば名称は簡易的なものでも大丈夫です。</p>
  <p>※スペース（空白）は不要です</p>
  <br />
  <button onclick="startVideo()">▶ 動画を開始する</button>
  <div id="errorMessage" class="error-message hidden"></div>
</div>

<div class="section hidden" id="videoSection">
  <div class="video-container">
    <video
      id="trainingVideo"
      playsinline
      controls="false"
      controlslist="nodownload nofullscreen noremoteplayback"
      disablePictureInPicture
      oncontextmenu="return false;"
    >
      <source src="training.mp4" type="video/mp4" />
      お使いのブラウザは video タグをサポートしていません。
    </video>
  </div>
  <div id="customControls">
    <button onclick="togglePlayback()">⏯️ 一時停止 / 再開</button>
  </div>
  <div id="videoError" class="error-message hidden">
    動画ファイルが見つかりません。training.mp4 ファイルを確認してください。
  </div>
</div>

<div class="section hidden" id="quizIntroSection">
  <h3>e-Learning動画は以上です。</h3>
  <p>次は動画の理解度チェックを行います。</p>
  <button onclick="startQuiz()">動画の理解度チェックに進む</button>
</div>

<div class="section hidden" id="quizSection">
  <div id="quizContainer">
    <p>全3問のクイズに全問正解すると、受講完了登録に進めます。</p> 
    <p class="quiz-question" id="quizQuestion"></p>
    <div class="quiz-options" id="quizOptions"></div>
    <div class="quiz-message" id="quizMessage"></div>
    <button id="nextQuestionButton" onclick="goToNextQuestion()" class="hidden">次へ進む</button>
  </div>
</div>

<div class="section hidden" id="resultSection">
  <h3>以上で、今月のe-Learningは終了となります。</h3>
  <p>受講記録の保存ボタンを押してください。</p>
  <br />
  <button id="submitButton">📄 保存して終了する</button>
  <p id="submitMessage" style="margin-top: 1em; color: green;" class="hidden">お疲れさまでした！来月もよろしくお願いします。</p>
</div>

<script>
  let lastKnownTime = 0; // 動画の最終再生時刻を保持する変数
  let userName = ""; // ユーザー名を保持する変数
  let companyName = ""; // 会社名を保持する変数
  let deviceInfo = ""; // デバイス情報を保持する変数

  // プライバシーポリシーに同意して次へ進む
  function agreeToPrivacyPolicy() {
    document.getElementById("privacySection").classList.add("hidden");
    document.getElementById("nameSection").classList.remove("hidden");
  }

  // デバイス情報を生成する関数
  function generateDeviceInfo() {
    const userAgent = navigator.userAgent;
    let os = "Unknown OS";
    let browser = "Unknown Browser";
    
    // OS判定
    if (userAgent.indexOf("Windows") !== -1) {
      os = "Windows";
    } else if (userAgent.indexOf("Mac") !== -1) {
      os = "Mac";
    } else if (userAgent.indexOf("Linux") !== -1) {
      os = "Linux";
    } else if (userAgent.indexOf("Android") !== -1) {
      os = "Android";
    } else if (userAgent.indexOf("iPhone") !== -1 || userAgent.indexOf("iPad") !== -1) {
      os = "iOS";
    }
    
    // ブラウザ判定
    if (userAgent.indexOf("Chrome") !== -1 && userAgent.indexOf("Edge") === -1) {
      browser = "Chrome";
    } else if (userAgent.indexOf("Firefox") !== -1) {
      browser = "Firefox";
    } else if (userAgent.indexOf("Safari") !== -1 && userAgent.indexOf("Chrome") === -1) {
      browser = "Safari";
    } else if (userAgent.indexOf("Edge") !== -1) {
      browser = "Edge";
    }
    
    return `${os} / ${browser}`;
  }
  
  // クイズの問題データ（10問）
  const quizQuestions = [
    {
      question: "警察署や労働基準監督署への報告は？",
      options: ["元請にお願いして報告してもらう", "会社に連絡して報告してもらう", "ヤバそうだったので自分で報告する", "必要ない"],
      answer: "元請にお願いして報告してもらう"
    },
    {
      question: "労災かどうかの判定を行うのは？",
      options: ["労働基準監督署", "医師", "元請", "救急隊員"],
      answer: "労働基準監督署"
    },
    {
      question: "休業４日以上の災害が発生した場合、客先には何日以内に報告する？",
      options: ["３日以内", "４日以内", "５日以内", "７日以内"],
      answer: "３日以内"
    },
    {
      question: "「労働者死傷病報告」が必要なときはどこに提出する？",
      options: ["所轄の労働基準監督署", "所轄の税務署", "所轄の消防署", "所轄の森林管理署"],
      answer: "所轄の労働基準監督署"
    },
    {
      question: "警察署や労働基準監督署の事情聴取へは？",
      options: ["元請けの指導に従い協力する", "怒られるので逃げる", "自分が悪者にならないように嘘をつく", "黙秘する"],
      answer: "元請けの指導に従い協力する"
    },
    {
      question: "病院の治療費や薬代がかかったときは？",
      options: ["元請の担当者が作成した書類をそれぞれの箇所に提出する", "被災者の自腹", "現場担当社員の給料から引かれる", "事故の現場を見ていた人で割り勘"],
      answer: "元請の担当者が作成した書類をそれぞれの箇所に提出する"
    },
    {
      question: "「労災隠し」の罰とは？",
      options: ["書類送検をされたり、５０万円以下の罰金刑", "警察と監督署に怒られる", "反省文", "何をされるかわからない"],
      answer: "書類送検をされたり、５０万円以下の罰金刑"
    },
    {
      question: "労働災害発生時の行動は誰の指示を仰ぐ？",
      options: ["元請け", "職長", "自分で考えて行動する", "被災者本人"],
      answer: "元請け"
    },
    {
      question: "従業員が作業中に軽い擦り傷を負ったとき、正しい対応は？",
      options: ["軽微なケガでも、まずは報告させる", "忙しいので、自己判断で処置して業務に戻らせる", "軽傷なので報告の必要はない", "大けがでなければ日報にだけ書けばよい"],
      answer: "軽微なケガでも、まずは報告させる"
    },
    {
      question: "次のうち、労災隠しを防止するために日常的にできることは？",
      options: ["休憩の際や、その日の作業終了時に、ケガなどがなかったか報告させる", "作業員に「自己責任で対応するように」と伝える", "問題が起きたときだけヒアリングを行う", "作業員の無事を祈る"],
      answer: "休憩の際や、その日の作業終了時に、ケガなどがなかったか報告させる"
    }
  ];

  let selectedQuizQuestions = []; // 実際に表示する3問を格納
  let currentQuestionIndex = 0; // 現在表示中のクイズのインデックス
  let correctAnswersCount = 0; // 正解数

  function showError(message) {
    const errorElement = document.getElementById("errorMessage");
    errorElement.textContent = message;
    errorElement.classList.remove("hidden");
  }

  function hideError() {
    const errorElement = document.getElementById("errorMessage");
    errorElement.classList.add("hidden");
  }

  function startVideo() {
    const nameInput = document.getElementById("userName");
    const companyInput = document.getElementById("companyName");
    userName = nameInput.value.trim(); // ユーザー名をグローバル変数に保存
    companyName = companyInput.value.trim(); // 会社名をグローバル変数に保存

    hideError(); // エラーメッセージをクリア

    // 1. 会社名チェック
    if (!companyName) {
      showError("会社名を入力してください。");
      return;
    }

    // 2. 名前が空欄の場合
    if (!userName) {
      showError("名前を入力してください。");
      return;
    }

    // 3. 名前の文字数チェック（3文字以上を許可）
    if (userName.length < 3) {
      showError("名前は3文字以上で入力してください。");
      return;
    }

    // 4. 半角文字のチェック（全角ひらがな、カタカナ、漢字のみを許可）
    const zenkakuRegex = /^[ぁ-んァ-ヶ一-龠]+$/;
    if (!zenkakuRegex.test(userName)) {
      showError("名前は全角のひらがな、カタカナ、または漢字で入力してください（スペースや半角文字は使用できません）。");
      return;
    }

    // 名前入力セクションのみ非表示
    document.getElementById("nameSection").classList.add("hidden");
    document.getElementById("videoSection").classList.remove("hidden");

    const video = document.getElementById("trainingVideo");

    // 動画ファイルのエラーチェック
    video.addEventListener('error', function() {
      document.getElementById("videoError").classList.remove("hidden");
    });

    // シークバー操作を無効化
    video.removeAttribute('controls'); 
    
    // 右クリック無効化
    video.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });
    
    // キーボードショートカット無効化
    video.addEventListener('keydown', function(e) {
      e.preventDefault();
      return false;
    });

    // 動画の再生時刻が更新されるたびにチェック
    video.addEventListener('timeupdate', function() {
      // 早送り防止
      if (video.currentTime > lastKnownTime + 1 && !video.paused) {
        video.currentTime = lastKnownTime;
      } else {
        lastKnownTime = video.currentTime;
      }
    });

    // シーク操作を無効化
    video.addEventListener('seeking', function(e) {
      e.preventDefault();
      video.currentTime = lastKnownTime;
    });
    
    // 動画の再生を試行
    video.play().catch(function(error) {
      console.error('Video play failed:', error);
      document.getElementById("videoError").classList.remove("hidden");
    });

    video.addEventListener("ended", () => {
      document.getElementById("videoSection").classList.add("hidden");
      document.getElementById("quizIntroSection").classList.remove("hidden");
    });
  }

  function togglePlayback() {
    const video = document.getElementById("trainingVideo");
    if (video.paused) {
      video.play().catch(function(error) {
        console.error('Video play failed:', error);
      });
    } else {
      video.pause();
    }
  }

  // 配列をシャッフルする関数
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startQuiz() {
    document.getElementById("quizIntroSection").classList.add("hidden");
    document.getElementById("quizSection").classList.remove("hidden");
    
    // クイズの状態をリセット
    currentQuestionIndex = 0;
    correctAnswersCount = 0;
    document.getElementById("quizMessage").innerText = "";
    document.getElementById("nextQuestionButton").classList.add("hidden");

    // 10問からランダムに3問選択
    selectedQuizQuestions = shuffleArray([...quizQuestions]).slice(0, 3);
    
    displayQuestion();
  }

  function displayQuestion() {
    const questionContainer = document.getElementById("quizQuestion");
    const optionsContainer = document.getElementById("quizOptions");
    const messageContainer = document.getElementById("quizMessage");
    const nextButton = document.getElementById("nextQuestionButton");

    messageContainer.innerText = "";
    nextButton.classList.add("hidden");

    if (currentQuestionIndex < selectedQuizQuestions.length) {
      const questionData = selectedQuizQuestions[currentQuestionIndex];
      questionContainer.innerText = `Q${currentQuestionIndex + 1}. ${questionData.question}`;
      optionsContainer.innerHTML = "";

      // 選択肢をシャッフル
      const shuffledOptions = shuffleArray([...questionData.options]);

      shuffledOptions.forEach((option, index) => {
        const button = document.createElement("button");
        button.innerText = option;
        button.onclick = () => checkAnswer(option);
        optionsContainer.appendChild(button);
      });
    } else {
      // 全問解答済みの場合、結果を表示
      showResult();
    }
  }

  function checkAnswer(selectedOption) {
    const questionData = selectedQuizQuestions[currentQuestionIndex];
    const messageContainer = document.getElementById("quizMessage");
    const optionsContainer = document.getElementById("quizOptions");
    const nextButton = document.getElementById("nextQuestionButton");

    // 全ての選択肢ボタンを無効化
    Array.from(optionsContainer.children).forEach(button => {
      button.disabled = true;
    });

    if (selectedOption === questionData.answer) {
      correctAnswersCount++;
      messageContainer.innerText = "正解です！";
      messageContainer.classList.remove("incorrect");
      messageContainer.classList.add("correct");
    } else {
      messageContainer.innerText = `不正解です。正解は「${questionData.answer}」でした。`;
      messageContainer.classList.remove("correct");
      messageContainer.classList.add("incorrect");
    }

    nextButton.classList.remove("hidden");
  }

  function goToNextQuestion() {
    currentQuestionIndex++;
    displayQuestion();
  }

  function showResult() {
    const quizSection = document.getElementById("quizSection");
    const resultSection = document.getElementById("resultSection");
    const quizContainer = document.getElementById("quizContainer");

    quizSection.classList.add("hidden");

    if (correctAnswersCount === selectedQuizQuestions.length) {
      // 全問正解の場合
      deviceInfo = generateDeviceInfo(); // デバイス情報を生成
      
      // 結果セクションを表示
      resultSection.classList.remove("hidden");
    } else {
      // 不正解がある場合
      resultSection.classList.add("hidden");
      quizContainer.innerHTML = `
        <p>残念！全問正解ではありませんでした。再度挑戦してください。</p>
        <button onclick="restartQuiz()">再度挑戦する</button>
      `;
      quizSection.classList.remove("hidden");
    }
  }

  function restartQuiz() {
    document.getElementById("quizContainer").innerHTML = `
      <p>全3問のクイズに全問正解すると、受講完了登録に進めます。</p> 
      <p class="quiz-question" id="quizQuestion"></p>
      <div class="quiz-options" id="quizOptions"></div>
      <div class="quiz-message" id="quizMessage"></div>
      <button id="nextQuestionButton" onclick="goToNextQuestion()" class="hidden">次へ進む</button>
    `;
    startQuiz();
  }

  function generateCode(name) {
    const firstCharCode = name.charCodeAt(0);
    const lastCharCode = name.charCodeAt(name.length - 1);
    const nameLength = name.length;

    const day = new Date().getMonth() + 1;
    const dayPlus11 = String(day + 11).padStart(2, "0");
    const reversedDay = dayPlus11.split("").reverse().join("");

    return `${firstCharCode}-${lastCharCode}-${nameLength}-${reversedDay}`;
  }

  function submitToSpreadsheet(code) {
    const timestamp = new Date().toLocaleString();

    return fetch("https://script.google.com/macros/s/AKfycbymwKMUUI7ertLjxxLvff-K1_tE-gYgCcx3jluNxoCTlGLiJtO0m2nYIBNYraUlVdFj/exec", {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        company: companyName,
        name: userName,
        datetime: timestamp,
        code: deviceInfo
      })
    }).catch(function(error) {
      console.error('スプレッドシート送信エラー:', error);
    });
  }

  // ページ読み込み後の処理
  document.addEventListener("DOMContentLoaded", function () {
    const submitButton = document.getElementById("submitButton");
    const submitMessage = document.getElementById("submitMessage");

    submitButton.addEventListener("click", function () {
      // スプレッドシートにデータを送信
      submitToSpreadsheet(deviceInfo);
      
      // メッセージを表示
      submitMessage.textContent = "保存しました。終了してください。";
      submitMessage.style.color = "blue";
      submitMessage.classList.remove("hidden");
      
      // ボタンを非表示にする
      submitButton.style.display = "none";
    });
  });
</script>

</body>
</html>